<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý danh sách đăng ký nguyện vọng</title>
    
    <link rel="stylesheet" href="/CSS/style.css">
    <link rel="stylesheet" href="/CSS/index.css"> 
    <link rel="stylesheet" href="/CSS/HD_DT.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="wrapper">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img src="/img/82cb2669b39c7ae0fe1d18507ed7c609168a2ad3.png" alt="Logo VLU">
            </div>
            <ul class="menu">

                <li class="menu-item">
                    <div class="menu-link active-parent"> <span><i class="fa-solid fa-layer-group"></i> Đợt đồ án</span>
                        <i class="fa-solid fa-chevron-right chevron"></i>
                    </div>
                    <ul class="submenu open"> <li><a href="index.html" class="active-sub">Quản lý đợt đồ án</a></li>
                        <li><a href="DS_DK.html">Danh sách đăng ký</a></li>
                        <li><a href="DS_DT.html">Danh sách đề tài</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <div class="menu-link">
                        <span><i class="fa-solid fa-users"></i> Hội đồng</span>
                        <i class="fa-solid fa-chevron-right chevron"></i>
                    </div>
                    <ul class="submenu">
                        <li><a href="HD_DT.html">Duyệt đề tài</a></li>
                        <li><a href="HD_BC.html">Báo cáo hội đồng</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <div class="menu-link">
                        <span><i class="fa-solid fa-list"></i> Danh mục</span>
                        <i class="fa-solid fa-chevron-right chevron"></i>
                    </div>
                    <ul class="submenu">
                        <li><a href="QL_Nganh.html">Ngành</a></li>
                        <li><a href="QL_BoMon.html" class="active-sub">Bộ môn</a></li> 
                        <li><a href="QL_ChuyenNganh.html">Chuyên ngành</a></li>
                        <li><a href="QL_HocKi.html">Học kì</a></li>
                        <li><a href="QL_Khoa.html">Khóa</a></li>
                        <li><a href="QL_CT.html">Chương trình</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <a href="QL_NguoiDung.html" class="menu-link">
                        <span><i class="fa-solid fa-user-gear"></i> Người dùng</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="CH_MAIL.html" class="menu-link">
                        <span><i class="fa-solid fa-gear"></i> Cấu hình</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="BCTK.html" class="menu-link">
                        <span><i class="fa-solid fa-chart-pie"></i> Báo cáo và thống kê</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <div class="uni-name">TRƯỜNG ĐẠI HỌC VĂN LANG</div>

                <div class="header-right-group">
        
                <div class="notification-container" id="notifDropdownBtn">
                    <div class="bell-icon-wrapper">
                        <i class="fa-regular fa-bell"></i>
                        <span class="notif-badge">3</span> </div>
                    
                    <div class="notif-dropdown-menu" id="notifDropdown">
                        <div class="notif-header">
                            <span>Thông báo</span>
                            <a href="#" class="mark-read">Đánh dấu đã đọc</a>
                        </div>
                        <div class="notif-body">
                            <div class="notif-item unread">
                                <div class="notif-icon"><i class="fa-solid fa-envelope-open-text"></i></div>
                                <div class="notif-content">
                                    <p class="n-title">Nhắc nhở mở đợt đăng ký</p>
                                    <p class="n-time">Vừa xong</p>
                                </div>
                            </div>
                            <div class="notif-item">
                                <div class="notif-icon"><i class="fa-solid fa-check-circle"></i></div>
                                <div class="notif-content">
                                    <p class="n-title">Hội đồng KTPM 01 đã được duyệt</p>
                                    <p class="n-time">1 giờ trước</p>
                                </div>
                            </div>
                            <div class="notif-item">
                                <div class="notif-icon"><i class="fa-solid fa-file-lines"></i></div>
                                <div class="notif-content">
                                    <p class="n-title">Sinh viên nộp báo cáo tiến độ</p>
                                    <p class="n-time">Yesterday</p>
                                </div>
                            </div>
                        </div>
                        <div class="notif-footer">
                            <a href="#">Xem tất cả</a>
                        </div>
                    </div>
                </div>

                <div class="user-dropdown-container" id="userDropdown">
                    <div class="user-profile">
                        <div class="user-info-text">
                            <span class="user-name">Admin 2174802010297</span>
                            <span class="user-role">BCN Khoa</span>
                        </div>
                        <i class="fa-regular fa-circle-user user-avatar-icon"></i>
                        <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
                    </div>

                    <ul class="dropdown-menu">
                        <li>
                            <a href="#" class="dropdown-item">
                                <i class="fa-regular fa-id-badge"></i> Hồ sơ cá nhân
                            </a>
                        </li>
                        <li>
                            <a href="#" class="dropdown-item logout-item">
                                <i class="fa-solid fa-arrow-right-from-bracket"></i> Đăng xuất
                            </a>
                        </li>
                    </ul>
                </div>
            </header>

            <div class="content-body">
                <div class="content-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                        <h2 class="page-title">Chi tiết hội đồng: HDBV004</h2>
                        <a href="HD_DT.html" style="color:#666; text-decoration:none; font-size:14px;">
                            <i class="fa-solid fa-arrow-left"></i> Quay lại
                        </a>
                    </div>

                    <div class="form-section">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:15px;">
                            
                            <div class="form-group">
                                <label>Tên hội đồng:</label>
                                <input type="text" class="form-control" value="Hội đồng Bảo vệ KTPM 02">
                            </div>
                            <div class="form-group">
                                <label>Bộ môn:</label>
                                <select class="form-control">
                                    <option selected>Công nghệ phần mềm</option>
                                    <option>Hệ thống thông tin</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Ngày bắt đầu:</label>
                                <input type="date" class="form-control" value="2025-11-27">
                            </div>
                            <div class="form-group">
                                <label>Ngày kết thúc:</label>
                                <input type="date" class="form-control" value="2025-11-28">
                            </div>

                        </div>
                    </div>

                    <h4 style="margin-bottom:15px; color:var(--primary-red);">Danh sách thành viên</h4>

                    <div class="add-member-bar">
                        <div class="member-search-container" id="searchContainer">
                            <input type="text" id="inputSearch" class="form-control" placeholder="Nhập tên, email hoặc MSSV giảng viên..." autocomplete="off">
                            <div class="suggestion-box" id="suggestionBox"></div>
                        </div>

                        <div class="selected-user-display" id="selectedDisplay">
                            <span id="selectedNameText">Trương Quốc Duy (2174802010297)</span>
                            <i class="fa-solid fa-xmark btn-remove-selection" id="btnClearSelection" title="Bỏ chọn"></i>
                        </div>

                        <select class="form-control" id="selectRole" style="width: 150px;">
                            <option value="Ủy viên">Ủy viên</option>
                            <option value="Thư ký">Thư ký</option>
                            <option value="Chủ tịch">Chủ tịch</option>
                        </select>

                        <button class="btn btn-primary" id="btnAddMember">
                            <i class="fa-solid fa-plus"></i> Thêm
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table id="memberTable">
                            <thead>
                                <tr>
                                    <th>Mã GV/SV</th>
                                    <th>Họ và tên</th>
                                    <th>Email</th>
                                    <th>Vai trò</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>

                    <div style="margin-top:30px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #eee; padding-top: 20px;">

                        <button class="btn" style="background-color: #28a745; color: white;" onclick="confirmApprove()">
                            <i class="fa-solid fa-check"></i> Duyệt hội đồng
                        </button>
                        <button class="btn btn-save" onclick="openSaveModal()">
                                <i class="fa-solid fa-floppy-disk"></i> Lưu thay đổi
                        </button>
                    </div>
                    
                </div>
            </div>
        </main>
    </div>
    <div class="modal-overlay" id="confirmSaveModal" style="z-index: 2000;">
        <div class="modal-dialog" style="width: 500px;">
            <div class="modal-header">
                <div class="modal-title" style="color: #28a745;">
                    <i class="fa-solid fa-circle-check"></i> Lưu dữ liệu thành công!
                </div>
                <button class="btn-close" onclick="closeSaveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 10px; font-size: 14px; color: #333;">
                    Thông tin hội đồng đã được cập nhật vào hệ thống.
                </p>
                <p style="font-weight: 600; font-size: 15px; color: var(--primary-red);">
                    Bạn có muốn DUYỆT hội đồng này để kích hoạt ngay bây giờ không?
                </p>
                <p style="font-size: 13px; color: #666; font-style: italic;">
                    (Nếu chọn "Chỉ lưu", trạng thái vẫn sẽ là "Chờ duyệt")
                </p>
            </div>
            <div style="margin-top:30px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #eee; padding-top: 20px;">

                <button class="btn" style="background-color: #28a745; color: white;" onclick="confirmApprove()">
                    <i class="fa-solid fa-check"></i> Duyệt hội đồng
                </button>

                <button class="btn btn-save" onclick="openSaveModal()">
                    <i class="fa-solid fa-floppy-disk"></i> Lưu thay đổi
                </button>

            /div>
        </div>
    </div>

    <script src="script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. DỮ LIỆU MẪU (Giả lập Database)
            const usersDB = [
                { id: "2174802010297", name: "Trương Quốc Duy", email: "duy.2174802010297@vanlanguni.vn" },
                { id: "2174802010311", name: "Ngô Thị Tuyết Như", email: "nhu.2174802010311@vanlanguni.vn" },
                { id: "GV001", name: "Nguyễn Văn Giảng Viên", email: "gv001@vanlanguni.vn" },
                { id: "GV002", name: "Trần Thị Thư Ký", email: "gv002@vanlanguni.vn" }
            ];

            // 2. KHAI BÁO BIẾN
            const inputSearch = document.getElementById('inputSearch');
            const suggestionBox = document.getElementById('suggestionBox');
            const searchContainer = document.getElementById('searchContainer');
            const selectedDisplay = document.getElementById('selectedDisplay');
            const selectedNameText = document.getElementById('selectedNameText');
            const btnClearSelection = document.getElementById('btnClearSelection');
            const btnAddMember = document.getElementById('btnAddMember');
            const selectRole = document.getElementById('selectRole');
            const tableBody = document.querySelector('#memberTable tbody');

            let currentUser = null; // Biến lưu người dùng đang được chọn (staging)

            // 3. HÀM TÌM KIẾM & GỢI Ý
            inputSearch.addEventListener('input', function() {
                const keyword = this.value.toLowerCase().trim();
                suggestionBox.innerHTML = ''; // Xóa gợi ý cũ

                if (keyword.length === 0) {
                    suggestionBox.style.display = 'none';
                    return;
                }

                // Lọc dữ liệu
                const matches = usersDB.filter(u => 
                    u.id.toLowerCase().includes(keyword) || 
                    u.name.toLowerCase().includes(keyword) || 
                    u.email.toLowerCase().includes(keyword)
                );

                if (matches.length > 0) {
                    suggestionBox.style.display = 'block';
                    matches.forEach(user => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.innerHTML = `
                            <div class="suggestion-info">
                                <span class="s-name">${user.name}</span>
                                <span class="s-mssv">${user.id} - ${user.email}</span>
                            </div>
                            <i class="fa-solid fa-plus" style="color:#aaa;"></i>
                        `;
                        
                        // SỰ KIỆN: Khi click vào 1 gợi ý
                        div.addEventListener('click', () => {
                            selectUser(user);
                        });
                        suggestionBox.appendChild(div);
                    });
                } else {
                    suggestionBox.style.display = 'none';
                }
            });

            // Ẩn gợi ý khi click ra ngoài
            document.addEventListener('click', (e) => {
                if (!searchContainer.contains(e.target)) {
                    suggestionBox.style.display = 'none';
                }
            });

            // 4. HÀM CHỌN NGƯỜI DÙNG (Dính lên box)
            function selectUser(user) {
                currentUser = user; // Lưu vào biến tạm
                
                // Ẩn ô tìm kiếm, Hiện ô đã chọn
                inputSearch.value = '';
                suggestionBox.style.display = 'none';
                searchContainer.style.display = 'none';
                
                selectedNameText.textContent = `${user.name} (${user.id})`;
                selectedDisplay.style.display = 'flex'; // Hiện box xanh
            }

            // 5. HÀM BỎ CHỌN (Reset lại ô tìm kiếm)
            btnClearSelection.addEventListener('click', () => {
                currentUser = null;
                selectedDisplay.style.display = 'none';
                searchContainer.style.display = 'block';
                inputSearch.focus();
            });

            // 6. HÀM THÊM VÀO BẢNG
            btnAddMember.addEventListener('click', () => {
                if (!currentUser) {
                    alert('Vui lòng tìm và chọn thành viên trước!');
                    return;
                }

                const role = selectRole.value;
                
                // Xử lý style cho Badge vai trò
                let roleClass = 'role-member';
                if(role === 'Chủ tịch') roleClass = 'role-chairman';
                if(role === 'Thư ký') roleClass = 'role-secretary';

                // Thêm dòng mới vào bảng
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${currentUser.id}</td>
                    <td style="font-weight:500;">${currentUser.name}</td>
                    <td>${currentUser.email}</td>
                    <td><span class="role-badge ${roleClass}">${role}</span></td>
                    <td>
                        <button class="action-btn btn-delete-icon" onclick="this.closest('tr').remove()">
                            <i class="fa-solid fa-trash"></i> Xóa
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);

                // Reset lại form sau khi thêm thành công
                btnClearSelection.click(); 
            });
            function confirmApprove() {
                    if(confirm("Bạn có chắc chắn muốn DUYỆT hội đồng này không?\nSau khi duyệt, hội đồng sẽ chính thức đi vào hoạt động.")) {
                        alert("Đã duyệt hội đồng thành công!");
                        // Ở đây sẽ có code gọi API cập nhật trạng thái
                        window.location.href = 'HD_DT.html'; // Quay về danh sách
                    }
            };

                        /* --- LOGIC XỬ LÝ LƯU VÀ GỢI Ý DUYỆT --- */
            const saveModal = document.getElementById('confirmSaveModal');

            // 1. Hàm mở Modal khi bấm nút Lưu
            function openSaveModal() {
                // Ở đây bạn có thể thêm code validate form trước khi mở modal
                // Giả lập lưu dữ liệu thành công...
                saveModal.style.display = 'flex';
            }

            // 2. Hàm đóng Modal
            function closeSaveModal() {
                saveModal.style.display = 'none';
            }

            // 3. Người dùng chọn "Chỉ lưu"
            function actionSaveOnly() {
                closeSaveModal();
                // Logic: Giữ nguyên trang hiện tại hoặc reload nhẹ
                // alert("Đã lưu nháp thành công!");
            }

            // 4. Người dùng chọn "Duyệt ngay"
            function actionSaveAndApprove() {
                closeSaveModal();
                // Logic: Gọi API duyệt hội đồng
                alert("Đã Lưu và Duyệt hội đồng thành công!\nHội đồng đã chính thức hoạt động.");
                window.location.href = 'QL_HoiDong.html'; // Chuyển về danh sách
            }

            // Đóng modal khi click ra ngoài
            window.addEventListener('click', (e) => {
                if (e.target === saveModal) closeSaveModal();
            });
        });
    </script> 
</body>
</html>