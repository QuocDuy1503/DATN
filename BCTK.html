<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo cáo Thống kê - VLU</title>
    
    <link rel="stylesheet" href="/CSS/style.css">
    <link rel="stylesheet" href="/CSS/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .btn-purple {
            background-color: #8A2BE2; color: white; border: none; padding: 8px 16px;
            border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-purple:hover { background-color: #7b27cc; }

        .summary-row {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;
        }
        .summary-card {
            background: white; padding: 20px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid #ddd;
            display: flex; align-items: center; justify-content: space-between;
        }
        .summary-info h3 { font-size: 28px; font-weight: 700; margin: 0; color: #333; }
        .summary-info p { margin: 5px 0 0; color: #666; font-size: 13px; font-weight: 600; text-transform: uppercase; }
        .summary-icon { font-size: 30px; opacity: 0.2; }

        .card-blue { border-left-color: #007bff; }
        .card-blue .summary-icon { color: #007bff; }
        
        .card-orange { border-left-color: #fd7e14; }
        .card-orange .summary-icon { color: #fd7e14; }

        .card-green { border-left-color: #28a745; }
        .card-green .summary-icon { color: #28a745; }

        .charts-container {
            display: grid; grid-template-columns: 2fr 1fr; gap: 20px;
        }
        .chart-box {
            background: white; padding: 20px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .chart-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px; text-align: center; }
    </style>
</head>
<body>
    <div class="wrapper">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img src="/img/82cb2669b39c7ae0fe1d18507ed7c609168a2ad3.png" alt="Logo VLU">
            </div>
            <ul class="menu">

                <li class="menu-item">
                    <div class="menu-link active-parent"> <span><i class="fa-solid fa-layer-group"></i> Đợt đồ án</span>
                        <i class="fa-solid fa-chevron-right chevron"></i>
                    </div>
                    <ul class="submenu open"> <li><a href="index.html" class="active-sub">Quản lý đợt đồ án</a></li>
                        <li><a href="DS_DK.html">Danh sách đăng ký</a></li>
                        <li><a href="DS_DT.html">Danh sách đề tài</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <div class="menu-link">
                        <span><i class="fa-solid fa-users"></i> Hội đồng</span>
                        <i class="fa-solid fa-chevron-right chevron"></i>
                    </div>
                    <ul class="submenu">
                        <li><a href="HD_DT.html">Duyệt đề tài</a></li>
                        <li><a href="HD_BC.html">Báo cáo hội đồng</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <div class="menu-link">
                        <span><i class="fa-solid fa-list"></i> Danh mục</span>
                        <i class="fa-solid fa-chevron-right chevron"></i>
                    </div>
                    <ul class="submenu">
                        <li><a href="QL_Nganh.html">Ngành</a></li>
                        <li><a href="QL_BoMon.html" class="active-sub">Bộ môn</a></li> 
                        <li><a href="QL_ChuyenNganh.html">Chuyên ngành</a></li>
                        <li><a href="QL_HocKi.html">Học kì</a></li>
                        <li><a href="QL_Khoa.html">Khóa</a></li>
                        <li><a href="QL_CT.html">Chương trình</a></li>
                    </ul>
                </li>

                <li class="menu-item">
                    <a href="QL_NguoiDung.html" class="menu-link">
                        <span><i class="fa-solid fa-user-gear"></i> Người dùng</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="CH_MAIL.html" class="menu-link">
                        <span><i class="fa-solid fa-gear"></i> Cấu hình</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="BCTK.html" class="menu-link">
                        <span><i class="fa-solid fa-chart-pie"></i> Báo cáo và thống kê</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <div class="uni-name">TRƯỜNG ĐẠI HỌC VĂN LANG</div>

                <div class="header-right-group">
        
                <div class="notification-container" id="notifDropdownBtn">
                    <div class="bell-icon-wrapper">
                        <i class="fa-regular fa-bell"></i>
                        <span class="notif-badge">3</span> </div>
                    
                    <div class="notif-dropdown-menu" id="notifDropdown">
                        <div class="notif-header">
                            <span>Thông báo</span>
                            <a href="#" class="mark-read">Đánh dấu đã đọc</a>
                        </div>
                        <div class="notif-body">
                            <div class="notif-item unread">
                                <div class="notif-icon"><i class="fa-solid fa-envelope-open-text"></i></div>
                                <div class="notif-content">
                                    <p class="n-title">Nhắc nhở mở đợt đăng ký</p>
                                    <p class="n-time">Vừa xong</p>
                                </div>
                            </div>
                            <div class="notif-item">
                                <div class="notif-icon"><i class="fa-solid fa-check-circle"></i></div>
                                <div class="notif-content">
                                    <p class="n-title">Hội đồng KTPM 01 đã được duyệt</p>
                                    <p class="n-time">1 giờ trước</p>
                                </div>
                            </div>
                            <div class="notif-item">
                                <div class="notif-icon"><i class="fa-solid fa-file-lines"></i></div>
                                <div class="notif-content">
                                    <p class="n-title">Sinh viên nộp báo cáo tiến độ</p>
                                    <p class="n-time">Yesterday</p>
                                </div>
                            </div>
                        </div>
                        <div class="notif-footer">
                            <a href="#">Xem tất cả</a>
                        </div>
                    </div>
                </div>

                <div class="user-dropdown-container" id="userDropdown">
                    <div class="user-profile">
                        <div class="user-info-text">
                            <span class="user-name">Admin 2174802010297</span>
                            <span class="user-role">BCN Khoa</span>
                        </div>
                        <i class="fa-regular fa-circle-user user-avatar-icon"></i>
                        <i class="fa-solid fa-chevron-down dropdown-arrow"></i>
                    </div>

                    <ul class="dropdown-menu">
                        <li>
                            <a href="#" class="dropdown-item">
                                <i class="fa-regular fa-id-badge"></i> Hồ sơ cá nhân
                            </a>
                        </li>
                        <li>
                            <a href="#" class="dropdown-item logout-item">
                                <i class="fa-solid fa-arrow-right-from-bracket"></i> Đăng xuất
                            </a>
                        </li>
                    </ul>
                </div>
            </header>

            <div class="content-body">
                <div class="content-card" style="background: transparent; box-shadow: none; padding: 0;">
                    
                    <div class="toolbar-row" style="background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px;">
                        <div style="display:flex; align-items:center; gap:15px;">
                            <h2 class="page-title" style="margin: 0; font-size: 18px;">Thống kê tổng hợp</h2>
                            <div style="width: 1px; height: 20px; background: #ddd;"></div>
                            
                            <span class="filter-label">Chọn đợt báo cáo:</span>
                            <select class="form-control" id="selectDot" style="width: 250px;">
                                <option value="dot1">Đợt 1 - Năm học 2024-2025</option>
                                <option value="dot2">Đợt 2 - Năm học 2024-2025</option>
                                <option value="dot3">Đợt 1 - Năm học 2023-2024</option>
                            </select>
                            
                            <button class="btn btn-purple" onclick="loadReport()">
                                <i class="fa-solid fa-filter"></i> Xem báo cáo
                            </button>
                        </div>
                        
                        <button class="btn" style="background: #e9ecef; color: #333;" onclick="window.print()">
                            <i class="fa-solid fa-print"></i> In báo cáo
                        </button>
                    </div>

                    <div class="summary-row">
                        <div class="summary-card card-blue">
                            <div class="summary-info">
                                <h3 id="numSV">0</h3>
                                <p>Sinh viên Đăng ký</p>
                            </div>
                            <div class="summary-icon"><i class="fa-solid fa-user-graduate"></i></div>
                        </div>

                        <div class="summary-card card-orange">
                            <div class="summary-info">
                                <h3 id="numDeTai">0</h3>
                                <p>Tổng số Đề tài</p>
                            </div>
                            <div class="summary-icon"><i class="fa-solid fa-book-open"></i></div>
                        </div>

                        <div class="summary-card card-green">
                            <div class="summary-info">
                                <h3 id="numPass">0</h3>
                                <p>Sinh viên Đậu</p>
                            </div>
                            <div class="summary-icon"><i class="fa-solid fa-medal"></i></div>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-box">
                            <div class="chart-title">Biểu đồ Tổng quan Đợt đồ án</div>
                            <canvas id="barChart"></canvas>
                        </div>

                        <div class="chart-box">
                            <div class="chart-title">Tỷ lệ Hoàn thành</div>
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        // Dữ liệu mẫu (Mock Data)
        const mockData = {
            'dot1': { sv: 150, detai: 45, pass: 140 }, // Đợt 1
            'dot2': { sv: 200, detai: 60, pass: 185 }, // Đợt 2
            'dot3': { sv: 120, detai: 40, pass: 100 }  // Đợt 3
        };

        let barChartInstance = null;
        let pieChartInstance = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadReport(); // Load mặc định đợt đầu tiên
        });

        function loadReport() {
            const selectedValue = document.getElementById('selectDot').value;
            const data = mockData[selectedValue];

            if (!data) return;

            // 1. Cập nhật số liệu trên thẻ Card (Hiệu ứng nhảy số)
            animateNumber('numSV', data.sv);
            animateNumber('numDeTai', data.detai);
            animateNumber('numPass', data.pass);

            // 2. Vẽ biểu đồ
            renderBarChart(data);
            renderPieChart(data);
        }

        // Hàm vẽ biểu đồ Cột (Bar Chart)
        function renderBarChart(data) {
            const ctx = document.getElementById('barChart').getContext('2d');
            
            // Xóa biểu đồ cũ nếu có để vẽ cái mới
            if (barChartInstance) barChartInstance.destroy();

            barChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Sinh viên Đăng ký', 'Số lượng Đề tài', 'Sinh viên Đậu'],
                    datasets: [{
                        label: 'Số lượng',
                        data: [data.sv, data.detai, data.pass],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)', // Xanh dương
                            'rgba(255, 159, 64, 0.7)', // Cam
                            'rgba(75, 192, 192, 0.7)'  // Xanh lá
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    },
                    plugins: {
                        legend: { display: false } // Ẩn chú thích vì đã có label trục X
                    }
                }
            });
        }

        // Hàm vẽ biểu đồ Tròn (Pie Chart) - Tỷ lệ Đậu/Rớt
        function renderPieChart(data) {
            const ctx = document.getElementById('pieChart').getContext('2d');
            const fail = data.sv - data.pass; // Tính số rớt

            if (pieChartInstance) pieChartInstance.destroy();

            pieChartInstance = new Chart(ctx, {
                type: 'doughnut', // Biểu đồ vành khuyên cho đẹp
                data: {
                    labels: ['Đậu', 'Chưa đạt'],
                    datasets: [{
                        data: [data.pass, fail],
                        backgroundColor: [
                            '#28a745', // Xanh lá
                            '#dc3545'  // Đỏ
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Hiệu ứng số chạy (Animation)
        function animateNumber(id, finalValue) {
            const element = document.getElementById(id);
            let startValue = 0;
            const duration = 800; // ms
            const stepTime = Math.abs(Math.floor(duration / finalValue));
            
            const timer = setInterval(() => {
                startValue += Math.ceil(finalValue / 20); // Bước nhảy
                if (startValue >= finalValue) {
                    startValue = finalValue;
                    clearInterval(timer);
                }
                element.textContent = startValue;
            }, 30);
        }
    </script>
</body>
</html>